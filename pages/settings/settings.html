<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Settings - Student ERP Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #6b7280;
            --border-color: #f1f5f9;
            --health-bg: linear-gradient(135deg, #f8fafc, #e2e8f0);
            --button-bg: rgba(255, 255, 255, 0.95);
            --button-text: #667eea;
            --shadow: rgba(0,0,0,0.1);
            --shadow-hover: rgba(0,0,0,0.2);
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --card-bg: rgba(30, 41, 59, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --health-bg: linear-gradient(135deg, #334155, #1e293b);
            --button-bg: rgba(30, 41, 59, 0.95);
            --button-text: #60a5fa;
            --shadow: rgba(0,0,0,0.3);
            --shadow-hover: rgba(0,0,0,0.5);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        html {
            scroll-behavior: smooth;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--button-bg);
            color: var(--button-text);
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px var(--shadow);
            backdrop-filter: blur(10px);
            border: none;
            cursor: pointer;
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--button-bg);
            color: var(--button-text);
            padding: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 20px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 15px var(--shadow);
            backdrop-filter: blur(10px);
        }

        .dark-mode-toggle:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px) rotate(180deg);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .back-button:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 80px;
        }

        /* Header Section - Top of Page */
        .top-header {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .status-dot {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .settings-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            background: linear-gradient(135deg, #4ade80, #06b6d4);
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }

        .header-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
            transition: color 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin: 40px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4ade80, #06b6d4);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .settings-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .settings-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: color 0.3s ease;
        }

        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .section-icon.users { background: linear-gradient(135deg, #667eea, #764ba2); }
        .section-icon.security { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .section-icon.backup { background: linear-gradient(135deg, #10b981, #059669); }
        .section-icon.system { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .section-icon.notifications { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .section-icon.integrations { background: linear-gradient(135deg, #06b6d4, #0891b2); }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .setting-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .setting-control {
            margin-left: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .select-control {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
            min-width: 120px;
            font-size: 0.9rem;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-small:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* System Health Section - Bottom of Page */
        .system-health {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-top: 50px;
            box-shadow: 0 10px 30px var(--shadow);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .health-item {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: var(--health-bg);
        }

        .health-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .health-value.good { color: #10b981; }
        .health-value.warning { color: #f59e0b; }
        .health-value.critical { color: #ef4444; }

        .health-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 80px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .container {
                padding-top: 100px;
            }
            
            .header-title {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 20px;
            }
            
            .settings-sections {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .health-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="goToMainPage()">
        <span>‚Üê</span> Back to Main
    </button>

    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        <span id="darkModeIcon">üåô</span>
    </button>

    <div class="container">
        <!-- Top Header Section -->
        <div class="top-header">
            <div class="status-dot"></div>
            <div class="settings-icon">‚öô</div>
            <h1 class="header-title">System Settings</h1>
            <p class="header-subtitle">User management, system configuration, backup & security settings</p>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="activeUsers">45</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uptime">99.8%</div>
                    <div class="stat-label">Uptime</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="backupStatus">Daily</div>
                    <div class="stat-label">Backups</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openSystemConfig()">
                    üîß System Config
                </button>
                <button class="btn btn-secondary" onclick="refreshSystemHealth()">
                    üíì System Health
                </button>
            </div>
        </div>

        <!-- Settings Sections -->
        <div class="settings-sections">
            <!-- User Management -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon users">üë•</div>
                    User Management
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Role-Based Access</div>
                        <div class="setting-desc">Enable role-based permissions</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('roleAccess', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Multi-Factor Auth</div>
                        <div class="setting-desc">Require 2FA for admin accounts</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('mfa', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Session Timeout</div>
                        <div class="setting-desc">Auto logout after inactivity</div>
                    </div>
                    <div class="setting-control">
                        <select class="select-control" onchange="handleSelect('sessionTimeout', this)">
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 hour</option>
                            <option value="120">2 hours</option>
                            <option value="240">4 hours</option>
                        </select>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">User Registration</div>
                        <div class="setting-desc">Manage user access</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="openUserManagement()">Manage</button>
                    </div>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon security">üîí</div>
                    Security Settings
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Data Encryption</div>
                        <div class="setting-desc">Encrypt sensitive data at rest</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('encryption', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Audit Logging</div>
                        <div class="setting-desc">Track all system activities</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('auditLog', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">IP Whitelist</div>
                        <div class="setting-desc">Restrict access by IP address</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="configureIPWhitelist()">Configure</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">SSL Certificate</div>
                        <div class="setting-desc">Secure connections (Valid until Dec 2024)</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="renewSSLCertificate()">Renew</button>
                    </div>
                </div>
            </div>

            <!-- Backup & Recovery -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon backup">üíæ</div>
                    Backup & Recovery
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Automatic Backups</div>
                        <div class="setting-desc">Daily automated backups</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('autoBackup', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Backup Frequency</div>
                        <div class="setting-desc">How often to create backups</div>
                    </div>
                    <div class="setting-control">
                        <select class="select-control" onchange="handleBackupFrequency(this)">
                            <option value="daily" selected>Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Cloud Storage</div>
                        <div class="setting-desc">Google Drive backup integration</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('cloudStorage', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Manual Backup</div>
                        <div class="setting-desc">Create backup now</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="createManualBackup()">Backup Now</button>
                    </div>
                </div>
            </div>

            <!-- System Configuration -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon system">‚öô</div>
                    System Configuration
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Maintenance Mode</div>
                        <div class="setting-desc">Put system in maintenance mode</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" onchange="handleMaintenanceMode(this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">System Timezone</div>
                        <div class="setting-desc">Default timezone for the system</div>
                    </div>
                    <div class="setting-control">
                        <select class="select-control" onchange="handleSelect('timezone', this)">
                            <option value="Asia/Kolkata" selected>Asia/Kolkata</option>
                            <option value="UTC">UTC</option>
                            <option value="US/Eastern">US/Eastern</option>
                            <option value="Europe/London">Europe/London</option>
                        </select>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Cache Settings</div>
                        <div class="setting-desc">Clear system cache</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="clearSystemCache()">Clear Cache</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">System Updates</div>
                        <div class="setting-desc">Check for updates</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="checkSystemUpdates()">Check Updates</button>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon notifications">üîî</div>
                    Notifications
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Email Notifications</div>
                        <div class="setting-desc">Send system alerts via email</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('emailNotifications', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">SMS Alerts</div>
                        <div class="setting-desc">Critical system alerts via SMS</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" onchange="handleToggle('smsAlerts', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">WhatsApp Integration</div>
                        <div class="setting-desc">Send notifications via WhatsApp</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="configureWhatsApp()">Configure</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Push Notifications</div>
                        <div class="setting-desc">Browser push notifications</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" onchange="handleToggle('pushNotifications', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Integrations -->
            <div class="settings-section">
                <div class="section-title">
                    <div class="section-icon integrations">üîó</div>
                    Integrations
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Google Workspace</div>
                        <div class="setting-desc">Connected and syncing</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="configureGoogleWorkspace()">Configure</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Payment Gateway</div>
                        <div class="setting-desc">Razorpay integration</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="configurePaymentGateway()">Configure</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">AI Services</div>
                        <div class="setting-desc">OpenAI & Google AI integration</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn-small" onclick="configureAIServices()">Configure</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Analytics</div>
                        <div class="setting-desc">Google Analytics tracking</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" checked onchange="handleToggle('analytics', this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Health Monitor - Bottom of Page -->
        <div class="system-health">
            <div class="section-title">
                <div class="section-icon system">üìä</div>
                System Health Monitor
            </div>
            
            <div class="health-grid">
                <div class="health-item">
                    <div class="health-value good" id="cpuUsage">2.1%</div>
                    <div class="health-label">CPU Usage</div>
                </div>
                <div class="health-item">
                    <div class="health-value good" id="memoryUsage">2.1GB</div>
                    <div class="health-label">Memory Used</div>
                </div>
                <div class="health-item">
                    <div class="health-value warning" id="diskUsage">67%</div>
                    <div class="health-label">Disk Usage</div>
                </div>
                <div class="health-item">
                    <div class="health-value good" id="responseTime">156ms</div>
                    <div class="health-label">Response Time</div>
                </div>
                <div class="health-item">
                    <div class="health-value good" id="systemUptime">99.8%</div>
                    <div class="health-label">Uptime</div>
                </div>
                <div class="health-item">
                    <div class="health-value good" id="healthActiveUsers">45</div>
                    <div class="health-label">Active Users</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Modal for configurations -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Configuration</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // System State Management
        const systemState = {
            settings: {
                roleAccess: true,
                mfa: true,
                encryption: true,
                auditLog: true,
                autoBackup: true,
                cloudStorage: true,
                emailNotifications: true,
                smsAlerts: false,
                pushNotifications: false,
                analytics: true
            },
            stats: {
                activeUsers: 45,
                uptime: 99.8,
                backupStatus: 'Daily'
            },
            health: {
                cpuUsage: '2.1%',
                memoryUsage: '2.1GB',
                diskUsage: '67%',
                responseTime: '156ms',
                systemUptime: '99.8%',
                healthActiveUsers: 45
            }
        };

        // Dark Mode Functionality
        function initializeDarkMode() {
            const savedTheme = sessionStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'true' || (!savedTheme && prefersDark)) {
                enableDarkMode();
            } else {
                disableDarkMode();
            }
        }

        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                disableDarkMode();
                sessionStorage.setItem('darkMode', 'false');
            } else {
                enableDarkMode();
                sessionStorage.setItem('darkMode', 'true');
            }
        }

        function enableDarkMode() {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
            document.querySelector('.dark-mode-toggle').title = 'Switch to Light Mode';
        }

        function disableDarkMode() {
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('darkModeIcon').textContent = 'üåô';
            document.querySelector('.dark-mode-toggle').title = 'Switch to Dark Mode';
        }

        // Navigation
        function goToMainPage() {
            window.location.href = '/index.html';
        }

        // Notification System
        function showNotification(message, type = 'success', duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // Settings Handlers
        function handleToggle(settingName, element) {
            systemState.settings[settingName] = element.checked;
            const status = element.checked ? 'enabled' : 'disabled';
            
            // Special handling for certain settings
            if (settingName === 'mfa' && !element.checked) {
                if (!confirm('Disabling multi-factor authentication will reduce security. Are you sure?')) {
                    element.checked = true;
                    return;
                }
            }
            
            if (settingName === 'encryption' && !element.checked) {
                if (!confirm('Disabling data encryption is not recommended. Continue anyway?')) {
                    element.checked = true;
                    return;
                }
            }

            showNotification(`${getSettingDisplayName(settingName)} has been ${status}`);
            saveSettings();
        }

        function handleSelect(settingName, element) {
            const value = element.value;
            showNotification(`${getSettingDisplayName(settingName)} updated to ${value}`);
            
            if (settingName === 'sessionTimeout') {
                showNotification('Session timeout will apply to new logins', 'info');
            }
            
            saveSettings();
        }

        function handleMaintenanceMode(element) {
            if (element.checked) {
                const confirmed = confirm(
                    'Are you sure you want to enable maintenance mode?\n\n' +
                    'This will:\n' +
                    '‚Ä¢ Make the system unavailable to users\n' +
                    '‚Ä¢ Display a maintenance message\n' +
                    '‚Ä¢ Only administrators can access the system'
                );
                
                if (confirmed) {
                    showNotification('Maintenance mode enabled - System is now offline for users', 'warning', 5000);
                    systemState.settings.maintenanceMode = true;
                } else {
                    element.checked = false;
                }
            } else {
                systemState.settings.maintenanceMode = false;
                showNotification('Maintenance mode disabled - System is back online');
            }
            saveSettings();
        }

        function handleBackupFrequency(element) {
            const freq = element.value.charAt(0).toUpperCase() + element.value.slice(1);
            document.getElementById('backupStatus').textContent = freq;
            systemState.stats.backupStatus = freq;
            showNotification(`Backup frequency set to ${freq}`);
            
            // Update next backup time
            const nextBackup = calculateNextBackup(element.value);
            showNotification(`Next backup scheduled for ${nextBackup}`, 'info');
            
            saveSettings();
        }

        // Action Handlers
        function openSystemConfig() {
            showModal('Advanced System Configuration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Database Configuration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure database connections and performance settings.</p>
                    
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Server Configuration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Manage server resources, load balancing, and caching.</p>
                    
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">API Configuration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure API endpoints, rate limiting, and authentication.</p>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn-small" onclick="showNotification('Configuration saved successfully')">Save Changes</button>
                    </div>
                </div>
            `);
        }

        function refreshSystemHealth() {
            showNotification('Refreshing system health data...', 'info');
            
            // Simulate real-time data update
            setTimeout(() => {
                updateHealthMetrics();
                showNotification('System health data updated');
            }, 1500);
        }

        function updateHealthMetrics() {
            const healthMetrics = {
                cpuUsage: (Math.random() * 10 + 1).toFixed(1) + '%',
                memoryUsage: (Math.random() * 3 + 1.5).toFixed(1) + 'GB',
                diskUsage: Math.floor(Math.random() * 30 + 60) + '%',
                responseTime: Math.floor(Math.random() * 100 + 100) + 'ms',
                systemUptime: (99.5 + Math.random() * 0.4).toFixed(1) + '%',
                healthActiveUsers: Math.floor(Math.random() * 20 + 35)
            };

            Object.keys(healthMetrics).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = healthMetrics[key];
                    
                    // Update health status classes
                    if (key === 'diskUsage') {
                        const value = parseInt(healthMetrics[key]);
                        element.className = value > 80 ? 'health-value critical' : 
                                          value > 70 ? 'health-value warning' : 'health-value good';
                    }
                }
            });

            systemState.health = healthMetrics;
        }

        function openUserManagement() {
            showModal('User Management', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Active Users: ${systemState.stats.activeUsers}</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">User Roles</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>Super Admin: 2 users</li>
                            <li>Admin: 8 users</li>
                            <li>Teacher: 15 users</li>
                            <li>Student: 20 users</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-small" onclick="showNotification('User creation form opened', 'info')">Add New User</button>
                        <button class="btn-small" onclick="showNotification('User list exported', 'success')">Export Users</button>
                        <button class="btn-small" onclick="showNotification('Bulk import started', 'info')">Import Users</button>
                    </div>
                </div>
            `);
        }

        function configureIPWhitelist() {
            showModal('IP Whitelist Configuration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Allowed IP Addresses</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure which IP addresses can access the system.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Current Whitelist:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px; font-family: monospace;">
                            <li>192.168.1.0/24 (Local Network)</li>
                            <li>203.0.113.0/24 (Office Network)</li>
                            <li>198.51.100.50 (Admin Home)</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <input type="text" placeholder="Enter IP address..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; margin-right: 10px; background: var(--card-bg); color: var(--text-primary);">
                        <button class="btn-small" onclick="showNotification('IP address added to whitelist')">Add IP</button>
                    </div>
                </div>
            `);
        }

        function renewSSLCertificate() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="loading"></span> Renewing...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                showNotification('SSL certificate renewed successfully! Valid until Dec 2025');
            }, 2000);
        }

        function createManualBackup() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="loading"></span> Creating...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                const backupId = 'BKP_' + Date.now();
                showNotification(`Backup created successfully! ID: ${backupId}`);
            }, 3000);
        }

        function clearSystemCache() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="loading"></span> Clearing...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                showNotification('System cache cleared successfully! Performance may improve.');
            }, 1500);
        }

        function checkSystemUpdates() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="loading"></span> Checking...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Randomly show either up-to-date or updates available
                const hasUpdates = Math.random() > 0.7;
                if (hasUpdates) {
                    showNotification('3 updates available! Click to install.', 'warning');
                } else {
                    showNotification('System is up to date!');
                }
            }, 2000);
        }

        function configureWhatsApp() {
            showModal('WhatsApp Business API Configuration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">WhatsApp Integration Status</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure WhatsApp Business API for sending notifications and alerts.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Current Settings:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>Status: Connected</li>
                            <li>Phone Number: +91 98765 43210</li>
                            <li>Monthly Messages: 1,247 / 10,000</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-small" onclick="showNotification('Test message sent successfully')">Send Test Message</button>
                        <button class="btn-small" onclick="showNotification('WhatsApp settings updated')">Update Settings</button>
                    </div>
                </div>
            `);
        }

        function configureGoogleWorkspace() {
            showModal('Google Workspace Integration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Google Workspace Status</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Manage Google Workspace integration for SSO, Drive, and Calendar.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Connected Services:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>‚úÖ Single Sign-On (SSO)</li>
                            <li>‚úÖ Google Drive Backup</li>
                            <li>‚úÖ Calendar Integration</li>
                            <li>‚ùå Gmail API</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn-small" onclick="showNotification('Synchronization started')">Sync Now</button>
                        <button class="btn-small" onclick="showNotification('Gmail API enabled successfully')">Enable Gmail</button>
                    </div>
                </div>
            `);
        }

        function configurePaymentGateway() {
            showModal('Payment Gateway Configuration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Razorpay Integration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure payment processing for fees and transactions.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Account Status:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>Status: Active</li>
                            <li>Account ID: rzp_live_ILHaRI6BWfNVGS</li>
                            <li>This Month: ‚Çπ2,45,670 processed</li>
                            <li>Success Rate: 98.5%</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn-small" onclick="showNotification('Test payment processed successfully')">Test Payment</button>
                        <button class="btn-small" onclick="showNotification('Settlement report downloaded')">Download Report</button>
                    </div>
                </div>
            `);
        }

        function configureAIServices() {
            showModal('AI Services Configuration', `
                <div style="padding: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">AI Integration Services</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Configure AI-powered features and integrations.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Available Services:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>‚úÖ OpenAI GPT-4 (Content Generation)</li>
                            <li>‚úÖ Google AI (Translation)</li>
                            <li>‚ùå Claude API (Analysis)</li>
                            <li>‚úÖ Auto Grading System</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Usage This Month:</h4>
                        <ul style="color: var(--text-secondary); margin-left: 20px;">
                            <li>API Calls: 12,450 / 50,000</li>
                            <li>Tokens Used: 1.2M / 5M</li>
                            <li>Cost: $124.50 / $500.00</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn-small" onclick="showNotification('AI services tested successfully')">Test Services</button>
                        <button class="btn-small" onclick="showNotification('Claude API enabled')">Enable Claude</button>
                    </div>
                </div>
            `);
        }

        // Modal Functions
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('configModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('configModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Utility Functions
        function getSettingDisplayName(settingName) {
            const displayNames = {
                'roleAccess': 'Role-Based Access',
                'mfa': 'Multi-Factor Authentication',
                'encryption': 'Data Encryption',
                'auditLog': 'Audit Logging',
                'autoBackup': 'Automatic Backups',
                'cloudStorage': 'Cloud Storage',
                'emailNotifications': 'Email Notifications',
                'smsAlerts': 'SMS Alerts',
                'pushNotifications': 'Push Notifications',
                'analytics': 'Analytics',
                'sessionTimeout': 'Session Timeout',
                'timezone': 'System Timezone'
            };
            return displayNames[settingName] || settingName;
        }

        function calculateNextBackup(frequency) {
            const now = new Date();
            let nextBackup = new Date(now);
            
            switch(frequency) {
                case 'daily':
                    nextBackup.setDate(now.getDate() + 1);
                    break;
                case 'weekly':
                    nextBackup.setDate(now.getDate() + 7);
                    break;
                case 'monthly':
                    nextBackup.setMonth(now.getMonth() + 1);
                    break;
            }
            
            return nextBackup.toLocaleDateString() + ' at 2:00 AM';
        }

        function saveSettings() {
            try {
                sessionStorage.setItem('erpSystemSettings', JSON.stringify(systemState));
                console.log('Settings saved successfully');
            } catch (error) {
                console.error('Failed to save settings:', error);
                showNotification('Failed to save settings', 'error');
            }
        }

        function loadSettings() {
            try {
                const saved = sessionStorage.getItem('erpSystemSettings');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    Object.assign(systemState, parsed);
                    applyLoadedSettings();
                }
            } catch (error) {
                console.error('Failed to load settings:', error);
            }
        }

        function applyLoadedSettings() {
            // Apply toggle states
            Object.keys(systemState.settings).forEach(settingName => {
                const toggles = document.querySelectorAll(`input[onchange*="${settingName}"]`);
                toggles.forEach(toggle => {
                    if (toggle.type === 'checkbox') {
                        toggle.checked = systemState.settings[settingName];
                    }
                });
            });

            // Apply stats
            if (systemState.stats.activeUsers) {
                document.getElementById('activeUsers').textContent = systemState.stats.activeUsers;
            }
            if (systemState.stats.uptime) {
                document.getElementById('uptime').textContent = systemState.stats.uptime + '%';
            }
            if (systemState.stats.backupStatus) {
                document.getElementById('backupStatus').textContent = systemState.stats.backupStatus;
            }
        }

        // Real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                // Simulate real-time user count changes
                const userChange = Math.floor(Math.random() * 5) - 2; // -2 to +2
                const currentUsers = parseInt(document.getElementById('activeUsers').textContent);
                const newUserCount = Math.max(1, currentUsers + userChange);
                
                if (newUserCount !== currentUsers) {
                    document.getElementById('activeUsers').textContent = newUserCount;
                    document.getElementById('healthActiveUsers').textContent = newUserCount;
                    systemState.stats.activeUsers = newUserCount;
                }
                
                // Update uptime (very slowly increasing)
                const currentUptime = parseFloat(document.getElementById('uptime').textContent);
                const newUptime = Math.min(99.99, currentUptime + 0.001);
                document.getElementById('uptime').textContent = newUptime.toFixed(2) + '%';
                document.getElementById('systemUptime').textContent = newUptime.toFixed(2) + '%';
                systemState.stats.uptime = newUptime;
                
            }, 30000); // Update every 30 seconds
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure page starts at the top
            window.scrollTo(0, 0);
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
            
            initializeDarkMode();
            loadSettings();
            startRealTimeUpdates();
            
            // Update health metrics every 5 minutes
            setInterval(updateHealthMetrics, 300000);
        });

        // Ensure page always starts at top on load/refresh
        window.addEventListener('beforeunload', function() {
            window.scrollTo(0, 0);
        });

        window.addEventListener('load', function() {
            setTimeout(() => {
                window.scrollTo(0, 0);
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            }, 100);
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('configModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Escape key closes modal
            if (event.key === 'Escape') {
                closeModal();
            }
            
            // Ctrl/Cmd + D toggles dark mode
            if ((event.ctrlKey || event.metaKey) && event.key === 'd') {
                event.preventDefault();
                toggleDarkMode();
            }
            
            // Ctrl/Cmd + B creates backup
            if ((event.ctrlKey || event.metaKey) && event.key === 'b') {
                event.preventDefault();
                createManualBackup();
            }
        });

        // Auto-save settings every 2 minutes
        setInterval(saveSettings, 120000);

        console.log('ERP System Settings initialized successfully');
    </script>
</body>
</html>